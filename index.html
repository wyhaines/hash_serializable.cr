<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 1.0.0">
<meta name="crystal_docs.project_version" content="main">
<meta name="crystal_docs.project_name" content="hash_serializable">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="hash_serializable">
  <title>hash_serializable main</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          hash_serializable
        </a>
      </h1>

      <span class="project-version">
        main
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="hash_serializable/Hash" data-name="hash(k, v)">
      <a href="Hash.html">Hash</a>
      
        <ul>
  
  <li class=" " data-id="hash_serializable/Hash/Field" data-name="hash::field">
      <a href="Hash/Field.html">Field</a>
      
    </li>
  
  <li class="parent " data-id="hash_serializable/Hash/Serializable" data-name="hash::serializable">
      <a href="Hash/Serializable.html">Serializable</a>
      
        <ul>
  
  <li class=" " data-id="hash_serializable/Hash/Serializable/Strict" data-name="hash::serializable::strict">
      <a href="Hash/Serializable/Strict.html">Strict</a>
      
    </li>
  
  <li class=" " data-id="hash_serializable/Hash/Serializable/Unmapped" data-name="hash::serializable::unmapped(k)">
      <a href="Hash/Serializable/Unmapped.html">Unmapped</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="hash_serializable/Hash/SerializableError" data-name="hash::serializableerror">
      <a href="Hash/SerializableError.html">SerializableError</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="hash-serializable" class="anchor" href="#hash-serializable">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>hash_serializable</h1>

<p><img src="https://img.shields.io/github/workflow/status/wyhaines/hash_serializable.cr/hash_serializable%20CI?style=for-the-badge&logo=GitHub" alt="Send.cr CI"/>
<a href="https://github.com/wyhaines/hash_serializable.cr/releases"><img src="https://img.shields.io/github/release/wyhaines/hash_serializable.cr.svg?style=for-the-badge" alt="GitHub release"/></a>
<img src="https://img.shields.io/github/commits-since/wyhaines/hash_serializable.cr/latest?style=for-the-badge" alt="GitHub commits since latest release (by SemVer)"/></p>

<p>It can be useful to be able to serialize and deserialize between hashes
and objects the same way that one can between JSON and objects and YAML
and objects. This implementation is aiming to be feature-consistent with
JSON::Serializable and YAML::Serializable, while working with hashes.</p>

<p>The <code><a href="Hash/Serializable.html">Hash::Serializable</a></code> module automatically generates methods for serialization when included.</p>

<h3><a id="example" class="anchor" href="#example">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Example</h3>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;hash_serializable&quot;</span>

<span class="k">class</span> <span class="t">Note</span>
  <span class="k">include</span> <span class="t">Hash</span><span class="t">::</span><span class="t">Serializable</span>

  property message : <span class="t">String</span> <span class="o">=</span> <span class="s">&quot;DEFAULT&quot;</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">Location</span>
  <span class="k">include</span> <span class="t">Hash</span><span class="t">::</span><span class="t">Serializable</span>

  @[<span class="t">Hash</span><span class="t">::</span><span class="t">Field</span>(key: <span class="s">&quot;lat&quot;</span>)]
  property latitude : <span class="t">Float64</span>

  @[<span class="t">Hash</span><span class="t">::</span><span class="t">Field</span>(key: <span class="s">&quot;lon&quot;</span>)]
  property longitude : <span class="t">Float64</span>

  property note : <span class="t">Note</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">House</span>
  <span class="k">include</span> <span class="t">Hash</span><span class="t">::</span><span class="t">Serializable</span>

  property address : <span class="t">String</span>
  property location : <span class="t">Location</span>?
  property note : <span class="t">Note</span>
<span class="k">end</span>

arg <span class="o">=</span> {
  <span class="s">&quot;note&quot;</span> => {
    <span class="s">&quot;message&quot;</span> => <span class="s">&quot;Nice Address&quot;</span>,
  },
  <span class="s">&quot;address&quot;</span>  => <span class="s">&quot;Crystal Road 1234&quot;</span>,
  <span class="s">&quot;location&quot;</span> => {
    <span class="s">&quot;lat&quot;</span>  => <span class="n">12.3</span>,
    <span class="s">&quot;lon&quot;</span>  => <span class="n">34.5</span>,
    <span class="s">&quot;note&quot;</span> => {
      <span class="s">&quot;message&quot;</span> => <span class="s">&quot;hmmmm&quot;</span>,
    },
  },
}
house <span class="o">=</span> <span class="t">House</span>.from_hash(arg)

house.<span class="k">is_a?</span>(<span class="t">House</span>).should be_true
house.address.should eq <span class="s">&quot;Crystal Road 1234&quot;</span>
house.location.<span class="k">is_a?</span>(<span class="t">Location</span>).should be_true
house.location.not_nil!.latitude.should eq <span class="n">12.3</span>
house.location.not_nil!.longitude.should eq <span class="n">34.5</span>
house.note.message.should eq <span class="s">&quot;Nice Address&quot;</span>
house.location.not_nil!.note.message.should eq <span class="s">&quot;hmmmm&quot;</span>
house.to_hash.should eq arg</code></pre>

<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>

<ol><li>Add the dependency to your <code>shard.yml</code>:</li></ol>

<p><code></code>`yaml
   dependencies:</p>

<pre><code class="language-crystal"> hash_serializable:
   github: your-github-user/hash_serializable</code></pre>

<p><code></code>`</p>

<ol><li>Run <code>shards install</code></li></ol>

<h2><a id="usage" class="anchor" href="#usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usage</h2>

<p>Including <code><a href="Hash/Serializable.html">Hash::Serializable</a></code> will create <code>#to_hash</code> and <code>self.from_hash</code> methods
on the current class, and a constructor which takes a Hash. By default, <code>self.from_hash</code>
will deserialize a Hash into an instance of the object that it is passed to, according
to the definition of the class, and <code>#to_hash</code> will serialize the class into a Hash
containing the value of every instance variable, the keys being the instance variable
names.</p>

<p>It will descend through a nested class structure, where variables in one class
point to objects that, in turn, have instance variables. It should also deal correctly
with type unions.</p>

<p>To change how individual instance variables are parsed and serialized, the annotation
<code><a href="Hash/Field.html">Hash::Field</a></code> can be placed on the instance variable. Annotating property, getter, and
setter macros is also allowed.</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;hash_serializable&quot;</span>

<span class="k">struct</span> <span class="t">A</span>
  <span class="k">include</span> <span class="t">Hash</span><span class="t">::</span><span class="t">Serializable</span>

  @[<span class="t">Hash</span><span class="t">::</span><span class="t">Field</span>(key: <span class="s">&quot;my_key&quot;</span>)]
  getter a : <span class="t">Int32</span>?
<span class="k">end</span></code></pre>

<p><code><a href="Hash/Field.html">Hash::Field</a></code> properties:</p>

<ul><li><strong>ignore</strong>: if <code>true</code> skip this field in serialization and deserialization (by default false)</li><li><strong>ignore_serialize</strong>: if <code>true</code> skip this field in serialization (by default false)</li><li><strong>ignore_deserialize</strong>: if <code>true</code> skip this field in deserialization (by default false)</li><li><strong>key</strong>: the value of the key in the json object (by default the name of the instance variable)</li><li><strong>cast</strong>: takes either a proc, or a method name; if proc, the hash value will be passed to the proc, and the return value will be used as the value of the instance variable; if method, the method will be called <em>on</em> the hash value, and the return value used for the instance variable value</li><li><strong>presence</strong>: if <code>true</code>, a <code>@{{key}}_present</code> instance variable will be generated when the key was present (even if it has a <code>null</code> value), <code>false</code> by default; this does not declare the <code>@{{key}}_present</code> variable for you, so you will be responsible for ensuring that a Bool variable is declared</li></ul>

<p>Deserialization respects default values of variables.</p>

<h3><a id="extensions-hashserializablestrict-and-hashserializableunmapped" class="anchor" href="#extensions-hashserializablestrict-and-hashserializableunmapped">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Extensions: <code><a href="Hash/Serializable/Strict.html">Hash::Serializable::Strict</a></code> and <code><a href="Hash/Serializable/Unmapped.html">Hash::Serializable::Unmapped</a></code></h3>

<p>If the <code><a href="Hash/Serializable/Strict.html">Hash::Serializable::Strict</a></code> module is included, unknown properties in the Hash
document will raise an exception. By default the unknown properties are silently ignored.</p>

<p>If the <code><a href="Hash/Serializable/Unmapped.html">Hash::Serializable::Unmapped</a></code> module is included, unknown properties in the Hash
will be stored in a hash with an appropriate type signature. On serialization, any keys inside json_unmapped
will be serialized into the hash, as well.</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;hash_serializable&quot;</span>

<span class="k">struct</span> <span class="t">A</span>
  <span class="k">include</span> <span class="t">Hash</span><span class="t">::</span><span class="t">Serializable</span>
  <span class="k">include</span> <span class="t">Hash</span><span class="t">::</span><span class="t">Serializable</span><span class="t">::</span><span class="t">Unmapped</span>
  @a : <span class="t">Int32</span>
<span class="k">end</span>

a <span class="o">=</span> <span class="t">A</span>.from_json(<span class="s">%({&quot;a&quot;:1,&quot;b&quot;:2})</span>) <span class="c"># =&gt; A(@json_unmapped={&quot;b&quot; =&gt; 2_i64}, @a=1)</span>
a.to_json                         <span class="c"># =&gt; {&quot;a&quot;:1,&quot;b&quot;:2}</span></code></pre>

<h3><a id="casting" class="anchor" href="#casting">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Casting</h3>

<p><em>Hash::Serializable</em> can automatically convert values from one type to another. For example, if one has a <em>RequestParams</em> object that serialized the query parameters in an HTTP request, and one wanted to define a <em>user_id</em> field that was an integer, one might do something like this:</p>

<pre><code class="language-crystal"><span class="k">struct</span> <span class="t">RequestParams</span>
  use <span class="t">Hash</span><span class="t">::</span><span class="t">Serializable</span>

  @[<span class="t">Hash</span><span class="t">::</span><span class="t">Field</span>(cast: <span class="n">:to_i</span>)]
  getter user_id : <span class="t">Int32</span>
<span class="k">end</span>

params <span class="o">=</span> <span class="t">RequestParams</span>.<span class="k">new</span>({<span class="s">&quot;user_id&quot;</span> => <span class="s">&quot;123&quot;</span>})
pp params <span class="c"># &gt;    #&lt;RequestParams:0x7f2653e2f080 @user_id=123 &gt;</span></code></pre>

<p>One can also provide a proc to do the value conversion:</p>

<pre><code class="language-crystal"><span class="k">struct</span> <span class="t">MyObj</span>
  use <span class="t">Hash</span><span class="t">::</span><span class="t">Serializable</span>

  @[<span class="t">Hash</span><span class="t">::</span><span class="t">Field</span>(
    key: <span class="s">&quot;number&quot;</span>,
    cast: ->(x : <span class="t">String</span> <span class="o">|</span> <span class="t">Int</span><span class="t">::</span><span class="t">Signed</span> <span class="o">|</span> <span class="t">Int</span><span class="t">::</span><span class="t">Unsigned</span> <span class="o">|</span> <span class="t">Float</span><span class="t">::</span><span class="t">Primitive</span>) <span class="k">do</span>
      <span class="t">BigInt</span>.<span class="k">new</span>(x) <span class="o">**</span> <span class="n">2</span>
    <span class="k">end</span>)]
  getter square : <span class="t">BigInt</span>
<span class="k">end</span>

obj <span class="o">=</span> <span class="t">MyObj</span>.<span class="k">new</span>({<span class="s">&quot;number&quot;</span> => <span class="n">12345678901234567890</span>})
pp obj <span class="c"># &gt;    #&lt;MyObj:0x7fc5adbe5e80 @square=152415787532388367501905199875019052100&gt;</span></code></pre>

<p>The library does not yet support having procs or methods which will cast back to the original type.</p>

<h2><a id="development" class="anchor" href="#development">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Development</h2>

<p>If you want to help to fix bugs, clean up the code or the documentation, or help with additional features, fork the repository, and work in your fork, and then create a pull request against this repository.</p>

<p>Check <a href="https://github.com/wyhaines/hash_serializable.cr/issues">issues</a> for any known problems, and create new issues if you have problems or questions or feature requests.</p>

<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>

<ol><li>Fork it (&lt;https://github.com/wyhaines/hash_serializable/fork>)</li><li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li><li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li><li>Push to the branch (<code>git push origin my-new-feature</code>)</li><li>Create a new Pull Request</li></ol>

<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>

<ul><li><a href="https://github.com/wyhaines">Kirk Haines</a> - creator and maintainer</li></ul>

<p><img src="https://img.shields.io/github/languages/code-size/wyhaines/hash_serializable.cr?style=for-the-badge" alt="GitHub code size in bytes"/>
<img src="https://img.shields.io/github/issues/wyhaines/hash_serializable.cr?style=for-the-badge" alt="GitHub issues"/></p>
</div>
</body>
</html>
